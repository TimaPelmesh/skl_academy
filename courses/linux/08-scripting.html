<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Bash-скриптинг в Linux: создание скриптов, переменные, ввод данных, подстановка команд, математические операции. Изучите автоматизацию задач в Linux.">
    <meta name="keywords" content="bash скриптинг, shell script, переменные bash, автоматизация linux, bash команды">
    <meta name="author" content="SKL Academy">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="Bash-скриптинг в Linux — Автоматизация задач">
    <meta property="og:description" content="Изучите создание bash-скриптов в Linux: переменные, ввод данных, подстановка команд, математические операции.">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://skl-academy.ru/courses/linux/08-scripting.html">
    <meta property="og:site_name" content="SKL Academy">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Bash-скриптинг в Linux — Автоматизация задач">
    <meta name="twitter:description" content="Изучите создание bash-скриптов в Linux: переменные, ввод данных, подстановка команд, математические операции.">
    <title>Bash-скриптинг в Linux — Автоматизация задач | SKL Academy</title>
    <link rel="canonical" href="https://skl-academy.ru/courses/linux/08-scripting.html">
    <link rel="stylesheet" href="../courses.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <link rel="icon" href="../../images/icon.ico" type="image/x-icon">
    
    <!-- Structured Data: Breadcrumbs for Linux course -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Главная",
          "item": "https://skl-academy.ru/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "Linux и Bash",
          "item": "https://skl-academy.ru/courses/linux/01-linux-basics.html"
        },
        {
          "@type": "ListItem",
          "position": 3,
          "name": "Bash-скриптинг",
          "item": "https://skl-academy.ru/courses/linux/08-scripting.html"
        }
      ]
    }
    </script>
    
    
</head>
<body data-course="linux">
    <!-- Шапка сайта -->
    <header>
        <div class="menu-toggle" id="menuToggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <h1 class="header-title">Linux</h1>
        <div class="header-buttons">
            <!-- Кнопки переключения цветовой схемы -->
            <div class="color-scheme-buttons">
                <button class="color-scheme-btn" data-color="purple" title="Фиолетовая схема" aria-label="Фиолетовая цветовая схема">
                    <span class="color-dot" style="background: #6c63ff;"></span>
                </button>
                <button class="color-scheme-btn" data-color="orange" title="Оранжевая схема" aria-label="Оранжевая цветовая схема">
                    <span class="color-dot" style="background: #f97316;"></span>
                </button>
                <button class="color-scheme-btn" data-color="blue" title="Синяя схема" aria-label="Синяя цветовая схема">
                    <span class="color-dot" style="background: #3b82f6;"></span>
                </button>
            </div>
            <a href="07-search.html" class="prev-btn" title="Предыдущий урок">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
            </a>
            <a href="09-networking.html" class="next-btn" title="Следующий урок">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/></svg>
            </a>
            <!-- Кнопка переключения темы -->
            <button class="theme-toggle-btn" id="themeToggle" title="Переключить тему" aria-label="Переключить тему">
                <svg class="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z"/>
                </svg>
                <svg class="theme-icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 01.818.162z" clip-rule="evenodd"/>
                </svg>
            </button>
            <!-- Кнопка настроек (мобильная) -->
            <button class="mobile-settings-btn" id="mobileSettingsTrigger" title="Настройки" aria-label="Открыть настройки">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
            </button>
            <!-- Кнопка выхода -->
            <a href="../../index.html" class="exit-btn" title="На главную">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>
            </a>
        </div>
    </header>

    <!-- Основной контейнер -->
    <div class="container">
        <!-- Боковое меню -->
        <div id="sidebar" class="sidebar">
            <!-- Структура курса -->
            <div class="course-structure">
                <!-- Модуль 1 -->
                <div class="topic">
                    <button class="topic-btn">1. Знакомство с Linux</button>
                    <div class="subtopics">
                        <a href="01-linux-basics.html#introduction" class="subtopic">1.1 Введение в Linux</a>
                        <a href="01-linux-basics.html#distributions" class="subtopic">1.2 Дистрибутивы Linux</a>
                        <a href="01-linux-basics.html#installation" class="subtopic">1.3 Установка на виртуальную машину</a>
                        <a href="01-linux-basics.html#wsl" class="subtopic">1.4 WSL2 для Windows</a>
                        <a href="01-linux-basics.html#first-steps" class="subtopic">1.5 Первое знакомство</a>
                    </div>
                </div>
                
                <!-- Модуль 2 -->
                <div class="topic">
                    <button class="topic-btn">2. Файловая система</button>
                    <div class="subtopics">
                        <a href="02-file-system.html#terminal-shell" class="subtopic">2.1 Терминал и Shell</a>
                        <a href="02-file-system.html#file-system" class="subtopic">2.2 Файловая система Linux</a>
                        <a href="02-file-system.html#paths" class="subtopic">2.3 Пути и навигация</a>
                        <a href="02-file-system.html#commands" class="subtopic">2.4 Команды навигации</a>
                    </div>
                </div>
                
                <!-- Модуль 3 -->
                <div class="topic">
                    <button class="topic-btn">3. Работа с файлами</button>
                    <div class="subtopics">
                        <a href="03-file-operations.html#creating" class="subtopic">3.1 Создание файлов и каталогов</a>
                        <a href="03-file-operations.html#managing" class="subtopic">3.2 Копирование, перемещение, удаление</a>
                        <a href="03-file-operations.html#viewing" class="subtopic">3.3 Просмотр содержимого</a>
                        <a href="03-file-operations.html#editors" class="subtopic">3.4 Текстовые редакторы</a>
                    </div>
                </div>
                
                <!-- Модуль 4 -->
                <div class="topic">
                    <button class="topic-btn">4. Права доступа</button>
                    <div class="subtopics">
                        <a href="04-permissions.html#ownership" class="subtopic">4.1 Владелец и группа</a>
                        <a href="04-permissions.html#permissions" class="subtopic">4.2 Права доступа</a>
                        <a href="04-permissions.html#numeric" class="subtopic">4.3 Числовое представление</a>
                        <a href="04-permissions.html#analysis" class="subtopic">4.4 Анализ прав</a>
                    </div>
                </div>
                
                <!-- Модуль 5 -->
                <div class="topic">
                    <button class="topic-btn">5. Процессы</button>
                    <div class="subtopics">
                        <a href="05-processes.html#what-is-process" class="subtopic">5.1 Что такое процесс</a>
                        <a href="05-processes.html#viewing-processes" class="subtopic">5.2 Просмотр процессов</a>
                        <a href="05-processes.html#managing-processes" class="subtopic">5.3 Управление процессами</a>
                        <a href="05-processes.html#monitoring" class="subtopic">5.4 Мониторинг системы</a>
                    </div>
                </div>
                
                <!-- Модуль 6 -->
                <div class="topic">
                    <button class="topic-btn">6. Перенаправление</button>
                    <div class="subtopics">
                        <a href="06-redirection.html#streams" class="subtopic">6.1 Стандартные потоки</a>
                        <a href="06-redirection.html#output" class="subtopic">6.2 Перенаправление вывода</a>
                        <a href="06-redirection.html#input" class="subtopic">6.3 Перенаправление ввода</a>
                        <a href="06-redirection.html#pipes" class="subtopic">6.4 Конвейеры</a>
                    </div>
                </div>
                
                <!-- Модуль 7 -->
                <div class="topic">
                    <button class="topic-btn">7. Поиск</button>
                    <div class="subtopics">
                        <a href="07-search.html#find" class="subtopic">7.1 find - поиск файлов</a>
                        <a href="07-search.html#grep" class="subtopic">7.2 grep - поиск текста</a>
                        <a href="07-search.html#combination" class="subtopic">7.3 Комбинация find и grep</a>
                        <a href="07-search.html#locate" class="subtopic">7.4 locate - быстрый поиск</a>
                    </div>
                </div>
                
                <!-- Модуль 8 -->
                <div class="topic">
                    <button class="topic-btn active">8. Bash-скриптинг</button>
                    <div class="subtopics" style="max-height: 1000px;">
                        <a href="#what-is-script" class="subtopic active">8.1 Что такое скрипт</a>
                        <a href="#creating-scripts" class="subtopic">8.2 Создание и запуск</a>
                        <a href="#variables" class="subtopic">8.3 Переменные</a>
                        <a href="#input" class="subtopic">8.4 Ввод данных</a>
                        <a href="#command-substitution" class="subtopic">8.5 Подстановка команд</a>
                        <a href="#math" class="subtopic">8.6 Математические операции</a>
                        <a href="#conditions" class="subtopic">8.7 Условия (if/else)</a>
                        <a href="#loops" class="subtopic">8.8 Циклы (for/while/until)</a>
                        <a href="#case-select" class="subtopic">8.9 case и select</a>
                        <a href="#functions" class="subtopic">8.10 Функции</a>
                        <a href="#arrays" class="subtopic">8.11 Массивы</a>
                        <a href="#strings" class="subtopic">8.12 Работа со строками</a>
                        <a href="#error-handling" class="subtopic">8.13 Обработка ошибок</a>
                        <a href="#real-scripts" class="subtopic">8.14 Реальные скрипты</a>
                    </div>
                </div>
                
                <!-- Модуль 9 -->
                <div class="topic">
                    <button class="topic-btn">9. Сетевые утилиты</button>
                    <div class="subtopics">
                        <a href="09-networking.html#diagnostics" class="subtopic">9.1 Сетевая диагностика</a>
                        <a href="09-networking.html#connections" class="subtopic">9.2 Просмотр соединений</a>
                        <a href="09-networking.html#download" class="subtopic">9.3 Скачивание файлов</a>
                        <a href="09-networking.html#ssh" class="subtopic">9.4 SSH подключение</a>
                        <a href="09-networking.html#keys" class="subtopic">9.5 Аутентификация по ключам</a>
                        <a href="09-networking.html#file-transfer" class="subtopic">9.6 Передача файлов</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Основной контент -->
        <main class="content">
            <!-- Тема 8.1: Что такое скрипт -->
            <section id="what-is-script" class="topic-section">
                <h2>8.1 Что такое скрипт</h2>
                <div class="lesson-meta" style="display: none;">
                    <span class="difficulty">Сложность: начальная</span>
                    <span class="duration">Время изучения: 15 мин</span>
                </div>
                
                <div class="lesson-content">
                    <p>Скрипт — это текстовый файл, содержащий последовательность команд, которые выполняются интерпретатором (shell).</p>
                    
                    <h3>Преимущества скриптов</h3>
                    <div class="visual-guide">
                        <h4>Автоматизация</h4>
                        <p>Выполнение повторяющихся задач без ручного ввода команд</p>
                    </div>
                    
                    <div class="visual-guide">
                        <h4>Экономия времени</h4>
                        <p>Сложные операции выполняются одной командой</p>
                    </div>
                    
                    <div class="visual-guide">
                        <h4>Надежность</h4>
                        <p>Исключение человеческих ошибок при выполнении задач</p>
                    </div>

                    <h3>Shebang (#!/bin/bash)</h3>
                    <p>Первая строка скрипта, которая указывает интерпретатор для выполнения скрипта.</p>
                    
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash
# Это комментарий
echo "Hello World"</code></pre>
                    </div>

                    <h3>Типы скриптов</h3>
                    <div class="visual-guide">
                        <h4>Системные скрипты</h4>
                        <ul>
                            <li>Автозапуск сервисов</li>
                            <li>Резервное копирование</li>
                            <li>Мониторинг системы</li>
                        </ul>
                    </div>
                    
                    <div class="visual-guide">
                        <h4>Пользовательские скрипты</h4>
                        <ul>
                            <li>Автоматизация рутинных задач</li>
                            <li>Обработка файлов</li>
                            <li>Развертывание приложений</li>
                        </ul>
                    </div>

                    <div class="info">
                        <strong>Популярные интерпретаторы:</strong><br>
                        • <code>#!/bin/bash</code> — Bash (самый популярный)<br>
                        • <code>#!/bin/sh</code> — POSIX shell<br>
                        • <code>#!/usr/bin/python3</code> — Python<br>
                        • <code>#!/usr/bin/perl</code> — Perl
                    </div>
                </div>
            </section>

            <!-- Тема 8.2: Создание и запуск -->
            <section id="creating-scripts" class="topic-section">
                <h2>8.2 Создание и запуск скриптов</h2>
                <div class="lesson-content">
                    <p>Создание и запуск bash-скриптов — основа автоматизации в Linux.</p>
                    
                    <h3>Создание скрипта</h3>
                    <div class="code-example">
                        <pre><code class="bash">nano hello.sh              # создать скрипт в nano
# Или
vim hello.sh               # создать скрипт в vim</code></pre>
                    </div>

                    <h3>Содержимое скрипта</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash
# Мой первый скрипт
echo "Привет, мир!"
echo "Текущая дата: $(date)"
echo "Текущий пользователь: $USER"</code></pre>
                    </div>

                    <h3>Сделать скрипт исполняемым</h3>
                    <div class="code-example">
                        <pre><code class="bash">chmod +x hello.sh          # добавить права на выполнение
ls -l hello.sh             # проверить права
# -rwxr-xr-x 1 user group 123 Dec 15 10:30 hello.sh</code></pre>
                    </div>

                    <h3>Запуск скрипта</h3>
                    <div class="code-example">
                        <pre><code class="bash">./hello.sh                 # запустить скрипт
# Или
bash hello.sh              # запустить через bash</code></pre>
                    </div>

                    <h3>Проверка синтаксиса</h3>
                    <div class="code-example">
                        <pre><code class="bash">bash -n script.sh          # проверить синтаксис без выполнения
bash -x script.sh          # выполнить с выводом команд</code></pre>
                    </div>

                    <h3>Отладка скрипта</h3>
                    <div class="code-example">
                        <pre><code class="bash"># Добавить в скрипт для отладки:
set -x                     # включить отладку
echo "Отладочная информация"
set +x                     # выключить отладку</code></pre>
                    </div>

                    <div class="warning">
                        <strong>Безопасность:</strong> Всегда проверяйте содержимое скриптов перед запуском, особенно если они получены из интернета.
                    </div>
                </div>
            </section>

            <!-- Тема 8.3: Переменные -->
            <section id="variables" class="topic-section">
                <h2>8.3 Переменные в bash</h2>
                <div class="lesson-content">
                    <p>Переменные в bash позволяют хранить и использовать данные в скриптах.</p>
                    
                    <h3>Создание переменных</h3>
                    <div class="code-example">
                        <pre><code class="bash">name="Иван"                # создать переменную
age=25                    # числовая переменная
echo "Привет, $name!"     # использовать переменную
echo "Вам $age лет"       # использовать переменную</code></pre>
                    </div>

                    <h3>Системные переменные</h3>
                    <div class="code-example">
                        <pre><code class="bash">echo $HOME                 # домашний каталог
echo $USER                 # имя пользователя
echo $PWD                  # текущий каталог
echo $PATH                 # пути поиска команд
echo $0                    # имя скрипта</code></pre>
                    </div>

                    <h3>Переменные окружения</h3>
                    <div class="code-example">
                        <pre><code class="bash">export MY_VAR="значение"   # создать переменную окружения
echo $MY_VAR               # использовать переменную
env | grep MY_VAR          # показать переменную окружения</code></pre>
                    </div>

                    <h3>Специальные переменные</h3>
                    <div class="code-example">
                        <pre><code class="bash">echo $#                    # количество аргументов
echo $1                    # первый аргумент
echo $2                    # второй аргумент
echo $@                    # все аргументы
echo $?                    # код возврата последней команды</code></pre>
                    </div>

                    <h3>Работа с переменными</h3>
                    <div class="code-example">
                        <pre><code class="bash"># Проверка существования переменной
if [ -z "$MY_VAR" ]; then
    echo "Переменная не задана"
fi

# Значение по умолчанию
echo ${MY_VAR:-"по умолчанию"}

# Длина строки
text="Hello"
echo ${#text}              # выведет 5</code></pre>
                    </div>

                    <div class="info">
                        <strong>Важно:</strong> В bash переменные не имеют типов. Все значения — строки. Для математических операций используются специальные конструкции.
                    </div>
                </div>
            </section>

            <!-- Тема 8.4: Ввод данных -->
            <section id="input" class="topic-section">
                <h2>8.4 Ввод данных</h2>
                <div class="lesson-content">
                    <p>Команда read позволяет получать данные от пользователя во время выполнения скрипта.</p>
                    
                    <h3>Базовое использование read</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash
echo "Введите ваше имя:"
read name
echo "Привет, $name!"</code></pre>
                    </div>

                    <h3>Ввод с приглашением</h3>
                    <div class="code-example">
                        <pre><code class="bash">read -p "Введите ваш возраст: " age
echo "Вам $age лет"</code></pre>
                    </div>

                    <h3>Скрытый ввод (для паролей)</h3>
                    <div class="code-example">
                        <pre><code class="bash">read -s -p "Введите пароль: " password
echo "Пароль введен"</code></pre>
                    </div>

                    <h3>Ввод нескольких значений</h3>
                    <div class="code-example">
                        <pre><code class="bash">read -p "Введите имя и возраст: " name age
echo "Имя: $name, Возраст: $age"</code></pre>
                    </div>

                    <h3>Ввод с таймаутом</h3>
                    <div class="code-example">
                        <pre><code class="bash">if read -t 5 -p "Введите что-то за 5 секунд: " input; then
    echo "Вы ввели: $input"
else
    echo "Время истекло"
fi</code></pre>
                    </div>

                    <h3>Чтение из файла</h3>
                    <div class="code-example">
                        <pre><code class="bash"># Читать файл построчно
while read line; do
    echo "Строка: $line"
done < file.txt</code></pre>
                    </div>

                    <h3>Практический пример</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash
echo "=== Создание пользователя ==="
read -p "Имя пользователя: " username
read -s -p "Пароль: " password
echo
read -p "Полное имя: " fullname

echo "Создаем пользователя $username..."
# Здесь была бы команда создания пользователя
echo "Пользователь $username создан"</code></pre>
                    </div>
                </div>
            </section>

            <!-- Тема 8.5: Подстановка команд -->
            <section id="command-substitution" class="topic-section">
                <h2>8.5 Подстановка команд</h2>
                <div class="lesson-content">
                    <p>Подстановка команд позволяет использовать результат выполнения команды как значение переменной или аргумента.</p>
                    
                    <h3>Синтаксис подстановки</h3>
                    <div class="code-example">
                        <pre><code class="bash"># Старый синтаксис (обратные кавычки)
current_date=`date`
echo "Сегодня: $current_date"

# Новый синтаксис (рекомендуется)
current_date=$(date)
echo "Сегодня: $current_date"</code></pre>
                    </div>

                    <h3>Использование в переменных</h3>
                    <div class="code-example">
                        <pre><code class="bash"># Получить имя хоста
hostname=$(hostname)
echo "Имя компьютера: $hostname"

# Получить количество файлов
file_count=$(ls -1 | wc -l)
echo "Файлов в каталоге: $file_count"

# Получить размер каталога
dir_size=$(du -sh . | cut -f1)
echo "Размер каталога: $dir_size"</code></pre>
                    </div>

                    <h3>Использование в командах</h3>
                    <div class="code-example">
                        <pre><code class="bash"># Создать резервную копию с датой
cp important.txt backup_$(date +%Y%m%d).txt

# Показать файлы, измененные сегодня
ls -la $(find . -mtime 0)

# Подсчитать строки в файлах
echo "Всего строк: $(cat *.txt | wc -l)"</code></pre>
                    </div>

                    <h3>Вложенные подстановки</h3>
                    <div class="code-example">
                        <pre><code class="bash"># Получить имя каталога из полного пути
current_dir=$(basename $(pwd))
echo "Текущий каталог: $current_dir"

# Получить количество процессов
process_count=$(ps aux | wc -l)
echo "Процессов запущено: $process_count"</code></pre>
                    </div>

                    <h3>Практические примеры</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash
# Скрипт для создания резервной копии

backup_dir="backup_$(date +%Y%m%d_%H%M%S)"
mkdir "$backup_dir"

echo "Создаем резервную копию в $backup_dir"
cp -r /home/user/documents "$backup_dir/"

echo "Резервная копия создана"
echo "Размер: $(du -sh "$backup_dir" | cut -f1)"</code></pre>
                    </div>

                    <div class="info">
                        <strong>Совет:</strong> Используйте <code>$()</code> вместо обратных кавычек, так как это более читаемо и поддерживает вложенность.
                    </div>
                </div>
            </section>

            <!-- Тема 8.6: Математические операции -->
            <section id="math" class="topic-section">
                <h2>8.6 Математические операции</h2>
                <div class="lesson-content">
                    <p>В bash есть несколько способов выполнения математических операций.</p>
                    
                    <h3>Арифметическое расширение $(( ))</h3>
                    <div class="code-example">
                        <pre><code class="bash">a=10
b=5
result=$((a + b))
echo "Сумма: $result"

# Различные операции
echo "Сложение: $((a + b))"      # 15
echo "Вычитание: $((a - b))"     # 5
echo "Умножение: $((a * b))"     # 50
echo "Деление: $((a / b))"       # 2
echo "Остаток: $((a % b))"       # 0</code></pre>
                    </div>

                    <h3>Команда expr</h3>
                    <div class="code-example">
                        <pre><code class="bash">a=10
b=5
result=$(expr $a + $b)
echo "Результат: $result"

# Обратите внимание на пробелы вокруг операторов
echo "Умножение: $(expr $a \* $b)"  # экранирование *</code></pre>
                    </div>

                    <h3>Команда bc (калькулятор)</h3>
                    <div class="code-example">
                        <pre><code class="bash"># Простые вычисления
echo "2 + 3" | bc                # 5
echo "10 / 3" | bc               # 3
echo "scale=2; 10 / 3" | bc      # 3.33 (2 знака после запятой)

# Сложные вычисления
echo "sqrt(16)" | bc             # 4
echo "2^3" | bc                  # 8</code></pre>
                    </div>

                    <h3>Инкремент и декремент</h3>
                    <div class="code-example">
                        <pre><code class="bash">counter=0
echo "Начальное значение: $counter"

counter=$((counter + 1))
echo "После увеличения: $counter"

counter=$((counter - 1))
echo "После уменьшения: $counter"

# Сокращенная запись
counter=$((counter++))           # постфиксный инкремент
counter=$((++counter))           # префиксный инкремент</code></pre>
                    </div>

                    <h3>Сравнения</h3>
                    <div class="code-example">
                        <pre><code class="bash">a=10
b=5

if [ $a -gt $b ]; then
    echo "$a больше $b"
fi

if [ $a -eq 10 ]; then
    echo "$a равно 10"
fi</code></pre>
                    </div>

                    <h3>Практический пример</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash
# Калькулятор

read -p "Введите первое число: " num1
read -p "Введите второе число: " num2
read -p "Введите операцию (+, -, *, /): " op

case $op in
    +) result=$((num1 + num2)) ;;
    -) result=$((num1 - num2)) ;;
    \*) result=$((num1 * num2)) ;;
    /) result=$((num1 / num2)) ;;
    *) echo "Неизвестная операция"; exit 1 ;;
esac

echo "Результат: $result"</code></pre>
                    </div>

                    <div class="info">
                        <strong>Операторы сравнения:</strong><br>
                        • <code>-eq</code> — равно<br>
                        • <code>-ne</code> — не равно<br>
                        • <code>-gt</code> — больше<br>
                        • <code>-lt</code> — меньше<br>
                        • <code>-ge</code> — больше или равно<br>
                        • <code>-le</code> — меньше или равно
                    </div>
                </div>
            </section>

            <!-- Тема 8.7: Условия (if/else) -->
            <section id="conditions" class="topic-section">
                <h2>8.7 Условные конструкции: if / elif / else</h2>
                <div class="lesson-content">
                    <p>Условные конструкции позволяют скрипту принимать решения и выполнять разные действия в зависимости от условий. Это фундамент любого нетривиального скрипта.</p>

                    <h3>Базовый синтаксис if</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash

# Простое условие
if [ "$USER" = "root" ]; then
    echo "Вы вошли как root"
fi

# if / else
age=20
if [ "$age" -ge 18 ]; then
    echo "Вы совершеннолетний"
else
    echo "Вы несовершеннолетний"
fi

# if / elif / else
score=75
if [ "$score" -ge 90 ]; then
    echo "Отлично"
elif [ "$score" -ge 70 ]; then
    echo "Хорошо"
elif [ "$score" -ge 50 ]; then
    echo "Удовлетворительно"
else
    echo "Неудовлетворительно"
fi</code></pre>
                    </div>

                    <h3>Скобки [ ] vs [[ ]]</h3>
                    <p>В Bash существует два синтаксиса для условий. Двойные скобки <code>[[ ]]</code> — расширение Bash, безопаснее и мощнее.</p>
                    <div class="code-example">
                        <pre><code class="bash"># [ ] — POSIX-совместимый синтаксис (работает в sh)
# Обязательно ставить пробелы после [ и перед ]
if [ "$name" = "Иван" ]; then
    echo "Привет, Иван!"
fi

# [[ ]] — расширение Bash (рекомендуется)
# Поддерживает && ||, регулярные выражения, глобы
if [[ "$name" == "Иван" && "$age" -gt 18 ]]; then
    echo "Иван, добро пожаловать!"
fi

# Регулярные выражения (только в [[ ]])
email="user@example.com"
if [[ "$email" =~ ^[a-zA-Z0-9]+@[a-zA-Z]+\.[a-zA-Z]+$ ]]; then
    echo "Email валиден"
fi

# Глобы (только в [[ ]])
file="report.pdf"
if [[ "$file" == *.pdf ]]; then
    echo "Это PDF-файл"
fi</code></pre>
                    </div>

                    <h3>Проверка файлов</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash
file="/etc/passwd"

# Существует ли файл
if [ -f "$file" ]; then
    echo "Файл $file существует"
fi

# Существует ли директория
if [ -d "/home/user" ]; then
    echo "Директория существует"
fi

# Файл доступен для чтения / записи / выполнения
if [ -r "$file" ]; then echo "Можно читать"; fi
if [ -w "$file" ]; then echo "Можно писать"; fi
if [ -x "$file" ]; then echo "Можно выполнять"; fi

# Файл не пуст
if [ -s "$file" ]; then
    echo "Файл не пуст"
fi

# Файл существует (любого типа: файл, директория, ссылка...)
if [ -e "$file" ]; then
    echo "Объект существует"
fi

# Символическая ссылка
if [ -L "/usr/bin/python" ]; then
    echo "Это симлинк"
fi</code></pre>
                    </div>

                    <h3>Проверка строк</h3>
                    <div class="code-example">
                        <pre><code class="bash"># Строка пустая
if [ -z "$var" ]; then
    echo "Переменная пустая или не задана"
fi

# Строка НЕ пустая
if [ -n "$var" ]; then
    echo "Переменная содержит: $var"
fi

# Сравнение строк
if [ "$str1" = "$str2" ]; then
    echo "Строки равны"
fi

if [ "$str1" != "$str2" ]; then
    echo "Строки различаются"
fi</code></pre>
                    </div>

                    <h3>Логические операторы</h3>
                    <div class="code-example">
                        <pre><code class="bash"># И (AND) — оба условия должны быть истинны
if [ "$age" -ge 18 ] && [ "$citizen" = "yes" ]; then
    echo "Имеете право голоса"
fi

# Или (OR) — хотя бы одно условие истинно
if [ "$role" = "admin" ] || [ "$role" = "moderator" ]; then
    echo "Есть права на удаление"
fi

# НЕ (NOT) — инвертирует условие
if ! [ -f "/tmp/lock" ]; then
    echo "Lock-файл отсутствует, продолжаем"
fi</code></pre>
                    </div>

                    <h3>Однострочные условия</h3>
                    <div class="code-example">
                        <pre><code class="bash"># Используя && и ||
[ -f "config.yml" ] && echo "Конфиг найден" || echo "Конфига нет"

# Проверка кода возврата команды
grep -q "error" logfile.txt && echo "Найдены ошибки!"

# Тест перед действием
[ -d "backup" ] || mkdir backup</code></pre>
                    </div>

                    <div class="info">
                        <strong>Частые ошибки:</strong><br>
                        &bull; Забыть пробелы: <code>[$var="x"]</code> — ОШИБКА, нужно <code>[ "$var" = "x" ]</code><br>
                        &bull; Забыть кавычки: <code>[ $var = x ]</code> сломается если <code>$var</code> пустая<br>
                        &bull; Использовать <code>==</code> в <code>[ ]</code> — не POSIX, лучше <code>=</code><br>
                        &bull; Использовать <code>-eq</code> для строк — это только для чисел
                    </div>
                </div>
            </section>

            <!-- Тема 8.8: Циклы -->
            <section id="loops" class="topic-section">
                <h2>8.8 Циклы: for, while, until</h2>
                <div class="lesson-content">
                    <p>Циклы позволяют выполнять одни и те же действия многократно. В bash есть три основных типа циклов.</p>

                    <h3>Цикл for</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash

# Перебор списка значений
for fruit in яблоко груша банан; do
    echo "Фрукт: $fruit"
done

# Перебор файлов
for file in *.txt; do
    echo "Обрабатываю: $file"
    wc -l "$file"
done

# Перебор числового диапазона
for i in {1..10}; do
    echo "Итерация: $i"
done

# Диапазон с шагом
for i in {0..100..5}; do
    echo "$i"
done

# C-style for (как в C/Java)
for ((i = 0; i < 10; i++)); do
    echo "i = $i"
done

# Перебор аргументов скрипта
for arg in "$@"; do
    echo "Аргумент: $arg"
done

# Перебор строк из команды
for user in $(cut -d: -f1 /etc/passwd); do
    echo "Пользователь: $user"
done</code></pre>
                    </div>

                    <h3>Цикл while</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash

# Базовый while
counter=1
while [ "$counter" -le 5 ]; do
    echo "Счётчик: $counter"
    counter=$((counter + 1))
done

# Бесконечный цикл (с выходом по break)
while true; do
    read -p "Введите 'quit' для выхода: " input
    if [ "$input" = "quit" ]; then
        break
    fi
    echo "Вы ввели: $input"
done

# Чтение файла построчно (правильный способ)
while IFS= read -r line; do
    echo "Строка: $line"
done < "data.txt"

# Чтение вывода команды
ps aux | while read -r line; do
    echo "$line"
done

# while с несколькими условиями
attempts=0
max_attempts=3
while [ "$attempts" -lt "$max_attempts" ]; do
    echo "Попытка $((attempts + 1)) из $max_attempts"
    attempts=$((attempts + 1))
    sleep 1
done</code></pre>
                    </div>

                    <h3>Цикл until (пока НЕ выполнится)</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash

# until — выполняется пока условие ЛОЖНО
counter=1
until [ "$counter" -gt 5 ]; do
    echo "Счётчик: $counter"
    counter=$((counter + 1))
done

# Ожидание появления файла
until [ -f "/tmp/ready.flag" ]; do
    echo "Ожидаю файл-флаг..."
    sleep 2
done
echo "Файл найден! Продолжаем."

# Ожидание доступности сервиса
until ping -c 1 google.com &>/dev/null; do
    echo "Нет сети, ждём..."
    sleep 5
done
echo "Сеть доступна!"</code></pre>
                    </div>

                    <h3>break и continue</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash

# break — выйти из цикла
for i in {1..100}; do
    if [ "$i" -eq 5 ]; then
        echo "Достигнуто 5, выходим"
        break
    fi
    echo "$i"
done

# continue — пропустить итерацию
for i in {1..10}; do
    if [ $((i % 2)) -eq 0 ]; then
        continue    # пропускаем чётные
    fi
    echo "Нечётное: $i"
done

# break N — выход из вложенного цикла (N уровней)
for i in {1..3}; do
    for j in {1..3}; do
        if [ "$j" -eq 2 ]; then
            break 2   # выйти из обоих циклов
        fi
        echo "$i - $j"
    done
done</code></pre>
                    </div>

                    <h3>Практический пример: мониторинг процесса</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash
# Скрипт мониторинга процесса

process_name="nginx"
check_interval=10

echo "Мониторинг процесса: $process_name"

while true; do
    if pgrep -x "$process_name" > /dev/null; then
        echo "[$(date '+%H:%M:%S')] $process_name работает"
    else
        echo "[$(date '+%H:%M:%S')] $process_name НЕ НАЙДЕН! Перезапускаю..."
        systemctl restart "$process_name"
    fi
    sleep "$check_interval"
done</code></pre>
                    </div>
                </div>
            </section>

            <!-- Тема 8.9: case и select -->
            <section id="case-select" class="topic-section">
                <h2>8.9 Конструкции case и select</h2>
                <div class="lesson-content">
                    <p><code>case</code> — это мощная альтернатива цепочке if/elif для сравнения одной переменной с несколькими шаблонами. <code>select</code> создаёт интерактивное меню.</p>

                    <h3>Конструкция case</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash

read -p "Введите день недели: " day

case "$day" in
    понедельник|вторник|среда|четверг|пятница)
        echo "Рабочий день"
        ;;
    суббота|воскресенье)
        echo "Выходной!"
        ;;
    *)
        echo "Неизвестный день: $day"
        ;;
esac</code></pre>
                    </div>

                    <h3>case с шаблонами (глобы)</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash

filename="$1"

case "$filename" in
    *.tar.gz|*.tgz)
        echo "Распаковка tar.gz..."
        tar xzf "$filename"
        ;;
    *.tar.bz2)
        echo "Распаковка tar.bz2..."
        tar xjf "$filename"
        ;;
    *.zip)
        echo "Распаковка zip..."
        unzip "$filename"
        ;;
    *.7z)
        echo "Распаковка 7z..."
        7z x "$filename"
        ;;
    *)
        echo "Неизвестный формат: $filename"
        exit 1
        ;;
esac</code></pre>
                    </div>

                    <h3>case для обработки аргументов скрипта</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash
# Скрипт управления сервисом

case "$1" in
    start)
        echo "Запуск сервиса..."
        ;;
    stop)
        echo "Остановка сервиса..."
        ;;
    restart)
        echo "Перезапуск сервиса..."
        ;;
    status)
        echo "Проверка статуса..."
        ;;
    *)
        echo "Использование: $0 {start|stop|restart|status}"
        exit 1
        ;;
esac</code></pre>
                    </div>

                    <h3>Конструкция select (меню)</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash

echo "Выберите операционную систему:"
select os in "Ubuntu" "Fedora" "Arch" "Выход"; do
    case "$os" in
        Ubuntu)
            echo "Менеджер пакетов: apt"
            ;;
        Fedora)
            echo "Менеджер пакетов: dnf"
            ;;
        Arch)
            echo "Менеджер пакетов: pacman"
            ;;
        Выход)
            echo "До свидания!"
            break
            ;;
        *)
            echo "Неверный выбор, попробуйте снова"
            ;;
    esac
done</code></pre>
                    </div>
                </div>
            </section>

            <!-- Тема 8.10: Функции -->
            <section id="functions" class="topic-section">
                <h2>8.10 Функции</h2>
                <div class="lesson-content">
                    <p>Функции позволяют группировать команды, давать им имя и переиспользовать. Это делает скрипты читаемыми и поддерживаемыми.</p>

                    <h3>Объявление и вызов</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash

# Способ 1: с ключевым словом function
function greet() {
    echo "Привет, $1!"
}

# Способ 2: без function (POSIX-совместимый)
say_bye() {
    echo "Пока, $1!"
}

# Вызов функций
greet "Иван"       # Привет, Иван!
say_bye "Мария"    # Пока, Мария!</code></pre>
                    </div>

                    <h3>Аргументы функций</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash

create_user() {
    local username="$1"    # local — переменная видна только внутри функции
    local fullname="$2"
    local role="${3:-user}" # значение по умолчанию

    echo "Создаю пользователя:"
    echo "  Логин: $username"
    echo "  Имя: $fullname"
    echo "  Роль: $role"
    echo "  Всего аргументов: $#"
}

create_user "ivanov" "Иван Иванов" "admin"
create_user "petrov" "Пётр Петров"   # роль = "user" (по умолчанию)</code></pre>
                    </div>

                    <h3>Возвращаемые значения</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash

# Способ 1: return (код возврата 0-255)
is_root() {
    if [ "$(id -u)" -eq 0 ]; then
        return 0   # успех (true)
    else
        return 1   # неудача (false)
    fi
}

if is_root; then
    echo "Вы root"
else
    echo "Вы НЕ root"
fi

# Способ 2: echo (для возврата строк/чисел)
get_disk_usage() {
    local usage
    usage=$(df -h / | awk 'NR==2 {print $5}')
    echo "$usage"
}

disk=$(get_disk_usage)
echo "Использование диска: $disk"

# Способ 3: глобальная переменная (менее предпочтительно)
calculate() {
    RESULT=$(( $1 + $2 ))
}
calculate 10 20
echo "Результат: $RESULT"</code></pre>
                    </div>

                    <h3>Область видимости: local</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash

name="Глобальная"

test_scope() {
    local name="Локальная"
    echo "Внутри функции: $name"   # Локальная
}

test_scope
echo "Снаружи функции: $name"     # Глобальная

# ВАЖНО: без local переменная будет глобальной!
bad_function() {
    result="изменено"   # это ГЛОБАЛЬНАЯ переменная
}

result="оригинал"
bad_function
echo "$result"   # "изменено" — переменная была затёрта!</code></pre>
                    </div>

                    <h3>Практический пример: библиотека функций</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash
# Файл: lib.sh — библиотека полезных функций

log_info() {
    echo "[INFO $(date '+%Y-%m-%d %H:%M:%S')] $*"
}

log_error() {
    echo "[ERROR $(date '+%Y-%m-%d %H:%M:%S')] $*" >&2
}

file_exists() {
    [ -f "$1" ]
}

require_root() {
    if [ "$(id -u)" -ne 0 ]; then
        log_error "Этот скрипт требует прав root"
        exit 1
    fi
}

# В другом скрипте подключаем библиотеку:
# source lib.sh
# log_info "Скрипт запущен"
# require_root</code></pre>
                    </div>

                    <div class="info">
                        <strong>Правила хорошего тона:</strong><br>
                        &bull; Всегда используйте <code>local</code> для переменных внутри функций<br>
                        &bull; Давайте функциям говорящие имена: <code>validate_email</code>, а не <code>check</code><br>
                        &bull; Документируйте функции комментариями<br>
                        &bull; Выносите повторяющийся код в функции
                    </div>
                </div>
            </section>

            <!-- Тема 8.11: Массивы -->
            <section id="arrays" class="topic-section">
                <h2>8.11 Массивы</h2>
                <div class="lesson-content">
                    <p>Bash поддерживает индексированные и ассоциативные массивы. Они позволяют хранить коллекции значений в одной переменной.</p>

                    <h3>Индексированные массивы</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash

# Создание массива
fruits=("яблоко" "груша" "банан" "апельсин")

# Доступ к элементам (индексы с 0)
echo "${fruits[0]}"    # яблоко
echo "${fruits[2]}"    # банан

# Все элементы
echo "${fruits[@]}"    # яблоко груша банан апельсин

# Количество элементов
echo "${#fruits[@]}"   # 4

# Длина конкретного элемента
echo "${#fruits[0]}"   # 6 (длина слова "яблоко")

# Добавить элемент
fruits+=("манго")

# Удалить элемент
unset 'fruits[1]'      # удаляет "груша"

# Срез массива (элементы 1-2)
echo "${fruits[@]:1:2}"</code></pre>
                    </div>

                    <h3>Перебор массива</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash

servers=("web-01" "web-02" "db-01" "cache-01")

# Перебор значений
for server in "${servers[@]}"; do
    echo "Проверяю сервер: $server"
    ping -c 1 "$server" &>/dev/null && echo "  OK" || echo "  НЕДОСТУПЕН"
done

# Перебор с индексами
for i in "${!servers[@]}"; do
    echo "Сервер #$i: ${servers[$i]}"
done</code></pre>
                    </div>

                    <h3>Ассоциативные массивы (Bash 4+)</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash

# Объявление (обязательно declare -A)
declare -A config

config[host]="localhost"
config[port]="8080"
config[db]="myapp"
config[debug]="true"

# Доступ
echo "Хост: ${config[host]}"
echo "Порт: ${config[port]}"

# Все ключи
echo "Ключи: ${!config[@]}"

# Все значения
echo "Значения: ${config[@]}"

# Перебор
for key in "${!config[@]}"; do
    echo "$key = ${config[$key]}"
done

# Проверка существования ключа
if [[ -v config[debug] ]]; then
    echo "Ключ debug существует"
fi</code></pre>
                    </div>

                    <h3>Практический пример: парсинг CSV</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash
# Чтение CSV-файла в массивы

declare -a names
declare -a ages

i=0
while IFS=',' read -r name age; do
    names[$i]="$name"
    ages[$i]="$age"
    ((i++))
done < "users.csv"

echo "Загружено ${#names[@]} записей"
for i in "${!names[@]}"; do
    echo "${names[$i]} — ${ages[$i]} лет"
done</code></pre>
                    </div>
                </div>
            </section>

            <!-- Тема 8.12: Работа со строками -->
            <section id="strings" class="topic-section">
                <h2>8.12 Работа со строками</h2>
                <div class="lesson-content">
                    <p>Bash предоставляет множество встроенных операций для манипуляции строками без вызова внешних утилит.</p>

                    <h3>Подстроки и замены</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash

str="Hello World Bash Scripting"

# Длина строки
echo "${#str}"              # 25

# Подстрока (с позиции 6, 5 символов)
echo "${str:6:5}"           # World

# С конца
echo "${str: -9}"           # Scripting

# Удаление с начала (кратчайшее совпадение)
file="archive.tar.gz"
echo "${file#*.}"           # tar.gz

# Удаление с начала (длиннейшее совпадение)
echo "${file##*.}"          # gz

# Удаление с конца (кратчайшее)
echo "${file%.*}"           # archive.tar

# Удаление с конца (длиннейшее)
echo "${file%%.*}"          # archive

# Замена первого вхождения
echo "${str/World/Мир}"     # Hello Мир Bash Scripting

# Замена всех вхождений
text="a-b-c-d"
echo "${text//-/_}"         # a_b_c_d

# Приведение к верхнему/нижнему регистру (Bash 4+)
name="hello world"
echo "${name^^}"            # HELLO WORLD
echo "${name^}"             # Hello world (только первая буква)

upper="HELLO"
echo "${upper,,}"           # hello
echo "${upper,}"            # hELLO</code></pre>
                    </div>

                    <h3>Значения по умолчанию</h3>
                    <div class="code-example">
                        <pre><code class="bash"># Если переменная не задана — использовать значение по умолчанию
echo "${NAME:-Гость}"          # "Гость" если NAME пустая

# Если не задана — присвоить и использовать
echo "${NAME:=Гость}"          # присваивает NAME="Гость"

# Если не задана — вывести ошибку и завершить
echo "${NAME:?Переменная NAME обязательна}"

# Если задана — использовать альтернативное значение
echo "${NAME:+Пользователь задан}"</code></pre>
                    </div>
                </div>
            </section>

            <!-- Тема 8.13: Обработка ошибок -->
            <section id="error-handling" class="topic-section">
                <h2>8.13 Обработка ошибок: set, trap, коды возврата</h2>
                <div class="lesson-content">
                    <p>Надёжный скрипт должен корректно обрабатывать ошибки. Bash предоставляет для этого несколько механизмов.</p>

                    <h3>set — строгий режим</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash
set -euo pipefail

# set -e   : завершить скрипт при первой ошибке (ненулевой exit code)
# set -u   : считать неинициализированные переменные ошибкой
# set -o pipefail : ошибка в любой части пайпа = ошибка всего пайпа

# Рекомендуется ставить в начале КАЖДОГО скрипта!

# Пример: без set -e скрипт продолжит выполнение после ошибки
cd /nonexistent/path      # ← скрипт ОСТАНОВИТСЯ здесь
echo "Эта строка не выполнится"</code></pre>
                    </div>

                    <h3>trap — обработка сигналов</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash
set -euo pipefail

# Создаём временный файл
tmpfile=$(mktemp)
echo "Временный файл: $tmpfile"

# trap — выполнить команду при выходе (даже при ошибке)
trap 'rm -f "$tmpfile"; echo "Очистка завершена"' EXIT

# trap для конкретного сигнала
trap 'echo "Получен SIGINT (Ctrl+C), завершаюсь..."; exit 1' INT
trap 'echo "Получен SIGTERM"; exit 1' TERM

# Основная логика скрипта
echo "Работаю..."
echo "Данные" > "$tmpfile"
sleep 10   # Попробуйте нажать Ctrl+C

# При выходе (нормальном или аварийном) tmpfile будет удалён</code></pre>
                    </div>

                    <h3>Коды возврата и обработка ошибок</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash

# $? — код возврата последней команды (0 = успех)
ls /etc/passwd
echo "Код возврата: $?"   # 0

ls /nonexistent 2>/dev/null
echo "Код возврата: $?"   # 2 (не найдено)

# Обработка ошибок с ||
cp important.txt backup/ || {
    echo "Ошибка копирования!"
    exit 1
}

# Функция для обработки ошибок
die() {
    echo "ОШИБКА: $*" >&2
    exit 1
}

[ -f "config.yml" ] || die "Файл config.yml не найден"
[ -d "output" ] || die "Директория output не существует"</code></pre>
                    </div>

                    <h3>Перенаправление ошибок</h3>
                    <div class="code-example">
                        <pre><code class="bash"># stderr (поток 2) в файл
command 2> errors.log

# stderr и stdout в один файл
command &> output.log
# или
command > output.log 2>&1

# Подавить все ошибки
command 2>/dev/null

# Логирование с разделением потоков
./script.sh > stdout.log 2> stderr.log</code></pre>
                    </div>

                    <div class="warning">
                        <strong>Всегда начинайте скрипты с <code>set -euo pipefail</code>!</strong> Это предотвращает большинство скрытых ошибок. Без этого скрипт молча продолжит выполнение после ошибки, что может привести к потере данных.
                    </div>
                </div>
            </section>

            <!-- Тема 8.14: Реальные скрипты -->
            <section id="real-scripts" class="topic-section">
                <h2>8.14 Практика: реальные скрипты</h2>
                <div class="lesson-content">
                    <p>Закрепим все изученные концепции на примерах реальных скриптов, которые полезны в повседневной работе.</p>

                    <h3>Скрипт 1: Автоматический бэкап</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash
set -euo pipefail

# Конфигурация
SOURCE_DIR="/home/user/documents"
BACKUP_DIR="/backup"
MAX_BACKUPS=7
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_NAME="backup_${DATE}.tar.gz"

log() { echo "[$(date '+%H:%M:%S')] $*"; }

log "Начинаю резервное копирование..."

# Проверки
[ -d "$SOURCE_DIR" ] || { log "ОШИБКА: $SOURCE_DIR не найден"; exit 1; }
mkdir -p "$BACKUP_DIR"

# Создание архива
tar czf "${BACKUP_DIR}/${BACKUP_NAME}" -C "$(dirname "$SOURCE_DIR")" "$(basename "$SOURCE_DIR")"
log "Архив создан: $BACKUP_NAME ($(du -h "${BACKUP_DIR}/${BACKUP_NAME}" | cut -f1))"

# Ротация: удаляем старые бэкапы
backup_count=$(ls -1 "${BACKUP_DIR}"/backup_*.tar.gz 2>/dev/null | wc -l)
if [ "$backup_count" -gt "$MAX_BACKUPS" ]; then
    to_delete=$((backup_count - MAX_BACKUPS))
    ls -1t "${BACKUP_DIR}"/backup_*.tar.gz | tail -n "$to_delete" | xargs rm -f
    log "Удалено $to_delete старых бэкапов"
fi

log "Готово! Всего бэкапов: $(ls -1 "${BACKUP_DIR}"/backup_*.tar.gz | wc -l)"</code></pre>
                    </div>

                    <h3>Скрипт 2: Проверка здоровья серверов</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash
set -euo pipefail

servers=("web-01.example.com" "web-02.example.com" "db-01.example.com")
declare -A results

check_server() {
    local server="$1"
    if ping -c 1 -W 2 "$server" &>/dev/null; then
        echo "UP"
    else
        echo "DOWN"
    fi
}

echo "=== Проверка серверов: $(date) ==="
echo

for server in "${servers[@]}"; do
    status=$(check_server "$server")
    results["$server"]="$status"

    if [ "$status" = "UP" ]; then
        echo "  [OK]   $server"
    else
        echo "  [FAIL] $server"
    fi
done

# Подсчёт
up=0; down=0
for status in "${results[@]}"; do
    [ "$status" = "UP" ] && ((up++)) || ((down++))
done

echo
echo "Итого: $up работают, $down недоступны из ${#servers[@]}"</code></pre>
                    </div>

                    <h3>Скрипт 3: Парсинг аргументов командной строки</h3>
                    <div class="code-example">
                        <pre><code class="bash">#!/bin/bash
set -euo pipefail

# Значения по умолчанию
VERBOSE=false
OUTPUT_DIR="./output"
INPUT_FILE=""

usage() {
    cat &lt;&lt;EOF
Использование: $(basename "$0") [ОПЦИИ] ФАЙЛ

Опции:
  -o, --output DIR    Выходная директория (по умолчанию: ./output)
  -v, --verbose       Подробный вывод
  -h, --help          Показать справку

Пример:
  $(basename "$0") -v -o /tmp/results data.csv
EOF
    exit 0
}

# Парсинг аргументов
while [[ $# -gt 0 ]]; do
    case "$1" in
        -o|--output)
            OUTPUT_DIR="$2"
            shift 2
            ;;
        -v|--verbose)
            VERBOSE=true
            shift
            ;;
        -h|--help)
            usage
            ;;
        -*)
            echo "Неизвестная опция: $1" >&2
            usage
            ;;
        *)
            INPUT_FILE="$1"
            shift
            ;;
    esac
done

# Проверки
[ -n "$INPUT_FILE" ] || { echo "Ошибка: не указан входной файл" >&2; usage; }
[ -f "$INPUT_FILE" ] || { echo "Ошибка: файл $INPUT_FILE не найден" >&2; exit 1; }

# Основная логика
$VERBOSE && echo "Входной файл: $INPUT_FILE"
$VERBOSE && echo "Выходная директория: $OUTPUT_DIR"

mkdir -p "$OUTPUT_DIR"
echo "Обработка $INPUT_FILE..."</code></pre>
                    </div>

                    <div class="info">
                        <strong>Задания для самостоятельной работы:</strong><br>
                        1. Напишите скрипт, который принимает директорию и выводит топ-10 файлов по размеру<br>
                        2. Создайте скрипт мониторинга использования диска с уведомлением при &gt; 80%<br>
                        3. Напишите скрипт, который переименовывает все .JPG файлы в .jpg (нижний регистр)<br>
                        4. Создайте скрипт автоматической ротации логов с архивированием старых
                    </div>
                </div>
            </section>

            </main>
    </div>

    <script src="../courses.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>
        // Инициализация подсветки синтаксиса
        hljs.highlightAll();
        
        // Обработка кликов по ссылкам в боковом меню
        document.addEventListener('DOMContentLoaded', function() {
            const subtopicLinks = document.querySelectorAll('.subtopic');
            subtopicLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    // Убираем активный класс со всех ссылок
                    subtopicLinks.forEach(l => l.classList.remove('active'));
                    // Добавляем активный класс к текущей ссылке
                    this.classList.add('active');
                });
            });
        });
    </script>

    <!-- Мобильное меню настроек -->
    <div class="mobile-settings-menu" id="mobileSettingsMenu">
        <div class="mobile-settings-content">
            <div class="mobile-settings-header">
                <h3>Настройки</h3>
                <button class="mobile-settings-close" id="mobileSettingsClose" aria-label="Закрыть настройки">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path fill-rule="evenodd" d="M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z" clip-rule="evenodd"/>
                    </svg>
                </button>
            </div>
            
            <div class="mobile-settings-section">
                <h4>Цветовая схема</h4>
                <div class="mobile-color-scheme-buttons">
                    <button class="mobile-color-scheme-btn" data-color="purple">
                        <span class="color-dot" style="background: #6c63ff;"></span>
                        <span>Фиолетовая</span>
                    </button>
                    <button class="mobile-color-scheme-btn" data-color="orange">
                        <span class="color-dot" style="background: #f97316;"></span>
                        <span>Оранжевая</span>
                    </button>
                    <button class="mobile-color-scheme-btn" data-color="blue">
                        <span class="color-dot" style="background: #3b82f6;"></span>
                        <span>Синяя</span>
                    </button>
                </div>
            </div>
            
            <div class="mobile-settings-section">
                <h4>Тема</h4>
                <button class="mobile-theme-toggle-btn" id="mobileThemeToggle">
                    <span class="theme-label">Светлая</span>
                    <svg class="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z"/>
                    </svg>
                    <svg class="theme-icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 01.818.162z" clip-rule="evenodd"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>
</body>
</html>