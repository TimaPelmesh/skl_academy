<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Git — Модуль 4: Слияние и разрешение конфликтов. Fast-Forward, 3-way merge, как решать конфликты.">
    <meta name="keywords" content="git merge, fast-forward, 3-way merge, конфликты git, разрешение конфликтов">
    <meta name="author" content="SKL Academy">
    <meta property="og:title" content="Git — Модуль 4: Слияние и конфликты">
    <meta property="og:description" content="Практикуем merge: сценарии, конфликты и их разрешение.">
    <title>Курс Git — Модуль 4: Слияние и конфликты | SKL Academy</title>
    <link rel="canonical" href="https://skl-academy.ru/courses/git/04-merging-and-conflicts.html">
    <link rel="stylesheet" href="../courses.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <link rel="icon" href="../../images/icon.ico" type="image/x-icon">
</head>
<body data-course="git">
    <header>
        <div class="menu-toggle" id="menuToggle"><span></span><span></span><span></span></div>
        <h1 class="header-title">Git</h1>
        <div class="header-buttons">
            <!-- Кнопки переключения цветовой схемы -->
            <div class="color-scheme-buttons">
                <button class="color-scheme-btn" data-color="purple" title="Фиолетовая схема" aria-label="Фиолетовая цветовая схема">
                    <span class="color-dot" style="background: #6c63ff;"></span>
                </button>
                <button class="color-scheme-btn" data-color="orange" title="Оранжевая схема" aria-label="Оранжевая цветовая схема">
                    <span class="color-dot" style="background: #f97316;"></span>
                </button>
                <button class="color-scheme-btn" data-color="blue" title="Синяя схема" aria-label="Синяя цветовая схема">
                    <span class="color-dot" style="background: #3b82f6;"></span>
                </button>
            </div>
            <!-- Кнопка переключения темы -->
            <button class="theme-toggle-btn" id="themeToggle" title="Переключить тему" aria-label="Переключить тему">
                <svg class="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z"/>
                </svg>
                <svg class="theme-icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 01.818.162z" clip-rule="evenodd"/>
                </svg>
            </button>
            <!-- Кнопка настроек (мобильная) -->
            <button class="mobile-settings-btn" id="mobileSettingsTrigger" title="Настройки" aria-label="Открыть настройки">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
            </button>
            <!-- Кнопка выхода -->
            <a href="../../index.html" class="exit-btn" title="На главную">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>
            </a>
        </div>
    </header>

    <div class="container">
        <div id="sidebar" class="sidebar">
            <div class="course-structure">
                <div class="topic">
                    <button class="topic-btn">1. Философия и основы Git</button>
                    <div class="subtopics">
                        <a href="01-git-basics.html#vcs-intro" class="subtopic">1.1 Что такое VCS</a>
                        <a href="01-git-basics.html#git-advantages" class="subtopic">1.2 Почему Git</a>
                        <a href="01-git-basics.html#key-concepts" class="subtopic">1.3 Ключевые понятия</a>
                        <a href="01-git-basics.html#file-states" class="subtopic">1.4 Состояния файла</a>
                        <a href="01-git-basics.html#git-architecture" class="subtopic">1.5 Архитектура</a>
                        <a href="01-git-basics.html#first-steps" class="subtopic">1.6 Первые шаги</a>
                    </div>
                </div>

                <div class="topic">
                    <button class="topic-btn">2. Коммиты и история</button>
                    <div class="subtopics">
                        <a href="02-commits-and-history.html#log-pro" class="subtopic">2.1 git log</a>
                        <a href="02-commits-and-history.html#git-show" class="subtopic">2.2 git show</a>
                        <a href="02-commits-and-history.html#amend" class="subtopic">2.3 amend</a>
                        <a href="02-commits-and-history.html#add-patch" class="subtopic">2.4 add -p</a>
                        <a href="02-commits-and-history.html#gitignore" class="subtopic">2.5 .gitignore</a>
                    </div>
                </div>

                <div class="topic">
                    <button class="topic-btn">3. Ветвление</button>
                    <div class="subtopics">
                        <a href="03-branching.html#branch-basics" class="subtopic">3.1 Основы веток</a>
                        <a href="03-branching.html#create-switch" class="subtopic">3.2 Создание/переключение</a>
                        <a href="03-branching.html#list-delete" class="subtopic">3.3 Список/удаление</a>
                        <a href="03-branching.html#compare" class="subtopic">3.4 Сравнение</a>
                        <a href="03-branching.html#workflow" class="subtopic">3.5 Практика</a>
                    </div>
                </div>

                <div class="topic">
                    <button class="topic-btn active">4. Слияние и конфликты</button>
                    <div class="subtopics" style="max-height: 1000px;">
                        <a href="#ff-vs-merge" class="subtopic active">4.1 FF vs 3‑way</a>
                        <a href="#conflicts" class="subtopic">4.2 Почему конфликты</a>
                        <a href="#markers" class="subtopic">4.3 Маркеры конфликтов</a>
                        <a href="#resolve" class="subtopic">4.4 Разрешение</a>
                        <a href="#tools" class="subtopic">4.5 Инструменты</a>
                        <a href="#strategies" class="subtopic">4.6 Стратегии и опции merge</a>
                        <a href="#ort-recursive" class="subtopic">4.7 Алгоритмы ort/recursive</a>
                        <a href="#rename-whitespace" class="subtopic">4.8 Переименования и whitespace</a>
                        <a href="#rerere" class="subtopic">4.9 rerere: запоминание решений</a>
                        <a href="#squash-history" class="subtopic">4.10 Squash merge и история</a>
                    </div>
                </div>

                <div class="topic">
                    <button class="topic-btn">5. Rebase</button>
                    <div class="subtopics">
                        <a href="05-rebase.html#rebase-vs-merge" class="subtopic">5.1 Rebase vs Merge</a>
                        <a href="05-rebase.html#interactive" class="subtopic">5.2 Интерактивный rebase</a>
                        <a href="05-rebase.html#conflicts" class="subtopic">5.3 Конфликты</a>
                        <a href="05-rebase.html#rules" class="subtopic">5.4 Правила</a>
                        <a href="05-rebase.html#cleanup" class="subtopic">5.5 Практика</a>
                    </div>
                </div>

                <div class="topic">
                    <button class="topic-btn">6. Удалённые репозитории</button>
                    <div class="subtopics">
                        <a href="06-remotes.html#clone" class="subtopic">6.1 Клонирование</a>
                        <a href="06-remotes.html#remotes" class="subtopic">6.2 Remotes</a>
                        <a href="06-remotes.html#fetch-pull" class="subtopic">6.3 fetch/pull</a>
                        <a href="06-remotes.html#push" class="subtopic">6.4 push/upstream</a>
                        <a href="06-remotes.html#protocols" class="subtopic">6.5 SSH/HTTPS</a>
                    </div>
                </div>

                <div class="topic">
                    <button class="topic-btn">7. Командная работа</button>
                    <div class="subtopics">
                        <a href="07-teamwork-and-practices.html#pr" class="subtopic">7.1 PR/MR</a>
                        <a href="07-teamwork-and-practices.html#review" class="subtopic">7.2 Code Review</a>
                        <a href="07-teamwork-and-practices.html#tags" class="subtopic">7.3 Теги</a>
                        <a href="07-teamwork-and-practices.html#stash" class="subtopic">7.4 Stash</a>
                        <a href="07-teamwork-and-practices.html#cherry" class="subtopic">7.5 Cherry-pick</a>
                    </div>
                </div>

                <div class="topic">
                    <button class="topic-btn">8. Спасение и откаты</button>
                    <div class="subtopics">
                        <a href="08-recovery-and-troubleshooting.html#restore" class="subtopic">8.1 restore/checkout</a>
                        <a href="08-recovery-and-troubleshooting.html#restore-source" class="subtopic">8.2 Из коммита</a>
                        <a href="08-recovery-and-troubleshooting.html#reset-revert" class="subtopic">8.3 reset vs revert</a>
                        <a href="08-recovery-and-troubleshooting.html#reflog" class="subtopic">8.4 reflog</a>
                        <a href="08-recovery-and-troubleshooting.html#algorithm" class="subtopic">8.5 Алгоритм</a>
                    </div>
                </div>

                <div class="topic">
                    <button class="topic-btn">9. Инструменты и интеграции</button>
                    <div class="subtopics">
                        <a href="09-tools-and-integrations.html#gui" class="subtopic">9.1 GUI</a>
                        <a href="09-tools-and-integrations.html#ssh" class="subtopic">9.2 SSH‑ключи</a>
                        <a href="09-tools-and-integrations.html#hooks" class="subtopic">9.3 Hooks</a>
                        <a href="09-tools-and-integrations.html#ci" class="subtopic">9.4 CI/CD</a>
                        <a href="09-tools-and-integrations.html#modern" class="subtopic">9.5 switch/restore</a>
                    </div>
                </div>

                <div class="topic">
                    <button class="topic-btn">10. Сводная практика</button>
                    <div class="subtopics">
                        <a href="10-summary-best-practices.html#end-to-end" class="subtopic">10.1 Сквозной пример</a>
                        <a href="10-summary-best-practices.html#best" class="subtopic">10.2 Лучшие практики</a>
                    </div>
                </div>
            </div>
        </div>

        <main id="content" class="content sidebar-active">
            <section class="module-intro topic-section">
                <h2>Модуль 4: Слияние и разрешение конфликтов</h2>
                <p>Слияние (merge) — один из ключевых моментов работы с Git. Это точка, где разрозненные линии разработки сходятся в единый результат. В этом модуле мы подробно разберём, как Git выполняет слияние, почему возникают конфликты, и — самое главное — как их уверенно и безопасно разрешать.</p>
                <p>Если вы когда-нибудь боялись нажать <code>git merge</code>, потому что «а вдруг всё сломается» — этот модуль для вас. После него конфликты перестанут пугать.</p>
            </section>

            <section id="ff-vs-merge" class="topic-section">
                <h2>4.1 Fast‑Forward vs 3‑way merge</h2>

                <p>Когда вы выполняете <code>git merge</code>, Git выбирает одну из двух стратегий в зависимости от состояния истории.</p>

                <h3>Fast‑Forward (перемотка вперёд)</h3>
                <p>Если целевая ветка (например, <code>main</code>) не получила новых коммитов с момента ответвления, Git просто «перемотает» указатель вперёд. Новый коммит слияния не создаётся.</p>

                <div class="visual-guide">
                    <h4>Когда происходит Fast‑Forward</h4>
                    <p>Представьте: вы создали ветку <code>feature</code> от <code>main</code>, сделали 3 коммита, а в <code>main</code> за это время никто ничего не добавлял. Git просто переставит указатель <code>main</code> на последний коммит <code>feature</code>.</p>
<pre>
До merge:
main:     A --- B
                 \
feature:          C --- D --- E

После git merge feature (FF):
main:     A --- B --- C --- D --- E
</pre>
                </div>

                <div class="code-example">
<pre><code class="bash"># Переключаемся на main
git switch main

# Сливаем feature (Git выполнит FF автоматически)
git merge feature/login

# Результат: Fast-forward
# main теперь указывает на тот же коммит, что и feature/login</code></pre>
                </div>

                <h3>3‑way merge (трёхсторонее слияние)</h3>
                <p>Если обе ветки получили новые коммиты после точки расхождения, Git выполняет трёхстороннее слияние: сравнивает общего предка, текущую ветку и вливаемую ветку, а затем создаёт специальный <strong>merge‑коммит</strong> с двумя родителями.</p>

                <div class="visual-guide">
                    <h4>Когда происходит 3‑way merge</h4>
<pre>
До merge:
main:     A --- B --- F --- G
                 \
feature:          C --- D --- E

После git merge feature (3-way):
main:     A --- B --- F --- G --- M  (merge-коммит)
                 \               /
feature:          C --- D --- E
</pre>
                    <p>Merge-коммит <code>M</code> имеет двух родителей: <code>G</code> и <code>E</code>. Он фиксирует факт слияния в истории.</p>
                </div>

                <div class="code-example">
<pre><code class="bash"># Принудительно создать merge-коммит, даже если возможен FF
git merge --no-ff feature/login

# Разрешить только FF (если невозможно — отмена)
git merge --ff-only feature/login</code></pre>
                </div>

                <h3>Когда что использовать?</h3>
                <div class="visual-guide">
                    <h4>Сравнение стратегий</h4>
                    <ul>
                        <li><strong>FF</strong> — чистая линейная история, но скрывает факт существования ветки. Подходит для маленьких правок и личных веток.</li>
                        <li><strong>--no-ff</strong> — всегда создаёт merge-коммит. Видно, какие коммиты пришли из ветки. Стандарт для командной работы.</li>
                        <li><strong>--ff-only</strong> — безопасный режим: если FF невозможен, merge отменяется. Полезно в CI/CD скриптах.</li>
                    </ul>
                </div>

                <div class="note">
                    <p><strong>Совет для команды:</strong> Договоритесь о стратегии заранее. Многие команды используют <code>--no-ff</code> по умолчанию, чтобы в истории всегда было видно, откуда пришли изменения. Это упрощает поиск регрессий: <code>git log --merges</code> покажет все точки слияния.</p>
                </div>
            </section>

            <section id="conflicts" class="topic-section">
                <h2>4.2 Почему возникают конфликты</h2>

                <p>Конфликт — это <strong>не ошибка</strong>. Это сигнал Git: «Я вижу, что одни и те же строки изменены в обеих ветках, и не могу решить за вас, какой вариант правильный».</p>

                <h3>Когда Git справляется сам</h3>
                <p>Если изменения в двух ветках затрагивают <strong>разные файлы</strong> или <strong>разные участки</strong> одного файла, Git объединит их автоматически. Вы даже не заметите, что произошло слияние.</p>

                <div class="code-example">
<pre><code class="bash"># Ветка A изменила строку 10 в файле app.py
# Ветка B изменила строку 50 в файле app.py
# Git объединит оба изменения без конфликта</code></pre>
                </div>

                <h3>Когда возникает конфликт</h3>
                <p>Конфликт возникает, когда обе ветки изменили <strong>одни и те же строки</strong> в одном файле по-разному. Git не знает, какую версию выбрать — вашу или коллеги — и просит разобраться вручную.</p>

                <div class="visual-guide">
                    <h4>Типичные причины конфликтов</h4>
                    <ul>
                        <li><strong>Одна строка, два варианта:</strong> вы написали <code>color: blue</code>, коллега — <code>color: red</code></li>
                        <li><strong>Удаление vs изменение:</strong> вы удалили функцию, коллега её отредактировал</li>
                        <li><strong>Переименование файла:</strong> вы переименовали файл, коллега отредактировал его под старым именем</li>
                        <li><strong>Рефакторинг:</strong> вы перенесли код в другое место, коллега изменил его на старом месте</li>
                    </ul>
                </div>

                <h3>Пошаговый пример: создаём конфликт</h3>
                <p>Давайте намеренно создадим конфликт, чтобы понять механику.</p>

                <div class="code-example">
<pre><code class="bash"># Шаг 1: Создаём репозиторий и начальный файл
mkdir conflict-demo && cd conflict-demo
git init
echo "Добро пожаловать в наш проект" > README.md
echo "Версия: 1.0" >> README.md
git add README.md
git commit -m "Начальный коммит"

# Шаг 2: Создаём ветку и меняем вторую строку
git switch -c feature/update-version
# Меняем «Версия: 1.0» на «Версия: 2.0»
sed -i 's/Версия: 1.0/Версия: 2.0/' README.md
git add README.md
git commit -m "Обновляем версию до 2.0"

# Шаг 3: Возвращаемся в main и тоже меняем вторую строку
git switch main
# Меняем «Версия: 1.0» на «Версия: 1.5-beta»
sed -i 's/Версия: 1.0/Версия: 1.5-beta/' README.md
git add README.md
git commit -m "Ставим бета-версию 1.5"

# Шаг 4: Пробуем слить — получаем конфликт!
git merge feature/update-version
# CONFLICT (content): Merge conflict in README.md
# Automatic merge failed; fix conflicts and then commit the result.</code></pre>
                </div>

                <div class="note">
                    <p><strong>Не паникуйте!</strong> Конфликт — это нормальная ситуация. Git не потерял ваши данные. Обе версии сохранены в файле, и вы можете в любой момент отменить слияние командой <code>git merge --abort</code>.</p>
                </div>
            </section>

            <section id="markers" class="topic-section">
                <h2>4.3 Маркеры конфликтов: что вы видите в файле</h2>

                <p>Когда Git обнаруживает конфликт, он записывает в файл обе версии, разделённые специальными маркерами. Давайте разберём их подробно.</p>

                <div class="code-example">
<pre><code class="bash">Добро пожаловать в наш проект
&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
Версия: 1.5-beta
=======
Версия: 2.0
&gt;&gt;&gt;&gt;&gt;&gt;&gt; feature/update-version</code></pre>
                </div>

                <div class="visual-guide">
                    <h4>Расшифровка маркеров</h4>
                    <ul>
                        <li><code>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</code> — начало вашей версии (текущая ветка, куда вы сливаете)</li>
                        <li>Текст между <code>&lt;&lt;&lt;&lt;&lt;&lt;&lt;</code> и <code>=======</code> — <strong>ваши изменения</strong></li>
                        <li><code>=======</code> — разделитель между двумя версиями</li>
                        <li>Текст между <code>=======</code> и <code>&gt;&gt;&gt;&gt;&gt;&gt;&gt;</code> — <strong>изменения из вливаемой ветки</strong></li>
                        <li><code>&gt;&gt;&gt;&gt;&gt;&gt;&gt; feature/update-version</code> — конец, имя вливаемой ветки</li>
                    </ul>
                </div>

                <h3>Конфликт в нескольких местах</h3>
                <p>В одном файле может быть несколько конфликтных участков. Каждый будет обёрнут своими маркерами. Нужно разрешить <strong>все</strong> конфликты в файле.</p>

                <div class="code-example">
<pre><code class="bash"># Как найти все конфликтные маркеры в проекте:
grep -rn "&lt;&lt;&lt;&lt;&lt;&lt;&lt;" .

# Посмотреть список конфликтных файлов:
git diff --name-only --diff-filter=U</code></pre>
                </div>

                <div class="tip">
                    <p><strong>Подсказка:</strong> если вы видите маркеры <code>&lt;&lt;&lt;&lt;&lt;&lt;&lt;</code> в коде после коммита — значит, вы забыли разрешить конфликт и закоммитили файл с маркерами. Это частая ошибка новичков! Проверяйте файлы перед коммитом.</p>
                </div>
            </section>

            <section id="resolve" class="topic-section">
                <h2>4.4 Разрешение конфликтов: пошаговый walkthrough</h2>

                <p>Разрешение конфликта — это процесс из четырёх шагов. Разберём каждый подробно.</p>

                <h3>Шаг 1: Понять, что произошло</h3>
                <p>Прежде чем редактировать файл, выясните контекст: кто и зачем сделал каждое изменение.</p>

                <div class="code-example">
<pre><code class="bash"># Посмотреть статус — какие файлы в конфликте
git status
# On branch main
# You have unmerged paths.
#   (fix conflicts and run "git commit")
#
# Unmerged paths:
#   both modified:   README.md

# Посмотреть, что изменилось в каждой ветке
git log --oneline --left-right main...feature/update-version
# > abc1234 Обновляем версию до 2.0
# < def5678 Ставим бета-версию 1.5

# Посмотреть diff с трёхсторонним контекстом
git diff</code></pre>
                </div>

                <h3>Шаг 2: Отредактировать файл</h3>
                <p>Откройте конфликтный файл в редакторе. Вам нужно:</p>
                <ol>
                    <li>Удалить все маркеры (<code>&lt;&lt;&lt;&lt;&lt;&lt;&lt;</code>, <code>=======</code>, <code>&gt;&gt;&gt;&gt;&gt;&gt;&gt;</code>)</li>
                    <li>Оставить правильную версию (или написать новую, объединяющую обе)</li>
                </ol>

                <div class="visual-guide">
                    <h4>Три варианта решения</h4>
                    <ul>
                        <li><strong>Вариант A — оставить свою версию:</strong></li>
                    </ul>
<pre>Добро пожаловать в наш проект
Версия: 1.5-beta</pre>
                    <ul>
                        <li><strong>Вариант B — принять версию коллеги:</strong></li>
                    </ul>
<pre>Добро пожаловать в наш проект
Версия: 2.0</pre>
                    <ul>
                        <li><strong>Вариант C — объединить обе версии (часто лучший выбор):</strong></li>
                    </ul>
<pre>Добро пожаловать в наш проект
Версия: 2.0-beta</pre>
                </div>

                <h3>Шаг 3: Добавить в staging</h3>
                <div class="code-example">
<pre><code class="bash"># После редактирования — помечаем файл как разрешённый
git add README.md

# Проверяем статус — файл больше не в "Unmerged"
git status
# All conflicts fixed but you are still merging.</code></pre>
                </div>

                <h3>Шаг 4: Завершить слияние</h3>
                <div class="code-example">
<pre><code class="bash"># Завершаем merge (Git предложит стандартное сообщение)
git commit
# Merge branch 'feature/update-version'

# Или с кастомным сообщением:
git commit -m "Merge feature/update-version: обновлена версия до 2.0-beta"</code></pre>
                </div>

                <h3>Если что-то пошло не так — отмена</h3>
                <div class="code-example">
<pre><code class="bash"># Отменить merge в любой момент (до git commit)
git merge --abort
# Всё вернётся к состоянию до merge</code></pre>
                </div>

                <div class="note">
                    <p><strong>Совет:</strong> Минимизируйте конфликты — синхронизируйтесь с основной веткой чаще. Чем дольше ветка живёт отдельно, тем больше конфликтов. Регулярный <code>git merge main</code> или <code>git rebase main</code> в feature-ветке — хорошая практика.</p>
                </div>
            </section>

            <section id="tools" class="topic-section">
                <h2>4.5 Инструменты для разрешения конфликтов</h2>

                <p>Разрешать конфликты в текстовом редакторе — рабочий, но не самый удобный способ. Существуют специальные инструменты, которые показывают три версии рядом: общего предка, вашу и вливаемую.</p>

                <h3>VS Code (встроенный merge-редактор)</h3>
                <p>VS Code автоматически подсвечивает конфликтные участки и предлагает кнопки:</p>
                <ul>
                    <li><strong>Accept Current Change</strong> — оставить вашу версию</li>
                    <li><strong>Accept Incoming Change</strong> — принять вливаемую</li>
                    <li><strong>Accept Both Changes</strong> — вставить обе версии</li>
                    <li><strong>Compare Changes</strong> — открыть 3-way diff</li>
                </ul>
                <p>Начиная с версии 1.69, VS Code предлагает полноценный 3-way merge editor: три панели (ваша версия, общий предок, вливаемая) и итоговый результат внизу.</p>

                <h3>Внешние merge-утилиты</h3>
                <div class="code-example">
<pre><code class="bash"># Настроить внешний инструмент
git config --global merge.tool meld      # или kdiff3, p4merge, vimdiff

# Запустить инструмент для разрешения конфликта
git mergetool

# После разрешения Git спросит: была ли merge успешна?
# Ответьте y, файл будет помечен как разрешённый</code></pre>
                </div>

                <div class="visual-guide">
                    <h4>Популярные merge-утилиты</h4>
                    <ul>
                        <li><strong>meld</strong> — графический, кросс-платформенный, бесплатный. Отлично показывает 3-way diff</li>
                        <li><strong>kdiff3</strong> — трёхсторонее сравнение с авторазрешением простых конфликтов</li>
                        <li><strong>P4Merge</strong> (Perforce) — мощный бесплатный инструмент с хорошей визуализацией</li>
                        <li><strong>vimdiff</strong> — для тех, кто живёт в терминале</li>
                        <li><strong>IntelliJ / WebStorm</strong> — один из лучших встроенных merge-редакторов на рынке</li>
                    </ul>
                </div>

                <h3>Быстрое разрешение: принять одну сторону целиком</h3>
                <div class="code-example">
<pre><code class="bash"># Принять нашу версию файла целиком (ours)
git checkout --ours path/to/file.txt
git add path/to/file.txt

# Принять версию вливаемой ветки целиком (theirs)
git checkout --theirs path/to/file.txt
git add path/to/file.txt</code></pre>
                </div>

                <div class="tip">
                    <p><strong>Осторожно с --ours / --theirs!</strong> Эти команды принимают файл <em>целиком</em>, а не отдельные конфликтные участки. Если в файле были и ваши изменения, и чужие в разных местах, вы потеряете одни из них.</p>
                </div>
            </section>

            <section id="strategies" class="topic-section">
                <h2>4.6 Стратегии и опции merge</h2>

                <p>Команда <code>git merge</code> принимает множество флагов, которые управляют поведением слияния.</p>

                <h3>Флаги Fast-Forward</h3>
                <div class="code-example">
<pre><code class="bash"># По умолчанию: FF если возможно, иначе 3-way
git merge feature

# Всегда создавать merge-коммит (рекомендуется для командной работы)
git merge --no-ff feature

# Только FF — если невозможно, отменить merge
git merge --ff-only feature</code></pre>
                </div>

                <h3>Squash merge</h3>
                <p>Все изменения из ветки собираются в один коммит, <strong>без создания merge-коммита</strong>. История ветки теряется — остаётся один сжатый коммит.</p>
                <div class="code-example">
<pre><code class="bash"># Собрать все изменения из feature в один коммит
git merge --squash feature

# Изменения в staging, но не закоммичены — нужно коммитить вручную
git commit -m "feat: добавлена авторизация (squash из feature/auth)"</code></pre>
                </div>

                <h3>Стратегии слияния</h3>
                <div class="visual-guide">
                    <h4>Основные стратегии merge</h4>
                    <ul>
                        <li><strong>ort</strong> (по умолчанию с Git 2.34+) — быстрый, улучшенная детекция переименований</li>
                        <li><strong>recursive</strong> — предыдущий алгоритм по умолчанию, всё ещё работает</li>
                        <li><strong>octopus</strong> — для одновременного слияния нескольких веток (используется автоматически при <code>git merge A B C</code>)</li>
                        <li><strong>ours</strong> — принимает текущую ветку целиком, игнорируя вливаемую (создаёт merge-коммит, но без изменений)</li>
                    </ul>
                </div>

                <div class="code-example">
<pre><code class="bash"># Явно указать стратегию
git merge -s ort feature
git merge -s recursive feature

# Опции стратегии (через -X)
git merge -X theirs feature     # при конфликтах автоматически принимать theirs
git merge -X ours feature       # при конфликтах автоматически принимать ours
git merge -X patience feature   # использовать «терпеливый» алгоритм diff</code></pre>
                </div>
            </section>

            <section id="ort-recursive" class="topic-section">
                <h2>4.7 Алгоритмы ort и recursive</h2>

                <p><strong>ort</strong> (Ostensibly Recursive's Twin) — это современная замена <code>recursive</code>, ставшая стратегией по умолчанию в Git 2.34+. Он быстрее и лучше обрабатывает переименования файлов.</p>

                <h3>Что улучшено в ort</h3>
                <ul>
                    <li><strong>Скорость:</strong> ort значительно быстрее при большом количестве файлов</li>
                    <li><strong>Переименования:</strong> лучше обнаруживает переименованные файлы и корректнее объединяет изменения</li>
                    <li><strong>Внутренняя архитектура:</strong> не модифицирует рабочую директорию до тех пор, пока слияние не вычислено — меньше шансов на «грязное» состояние при ошибке</li>
                </ul>

                <div class="code-example">
<pre><code class="bash"># Проверить версию Git (ort доступен с 2.34+)
git --version

# Явно использовать ort
git merge -s ort feature/auth

# Или recursive (для старых версий Git)
git merge -s recursive feature/auth</code></pre>
                </div>

                <div class="note">
                    <p><strong>На практике:</strong> если ваш Git версии 2.34+, ort используется автоматически. Разница заметна в крупных репозиториях с тысячами файлов. Для маленьких проектов результат идентичен.</p>
                </div>
            </section>

            <section id="rename-whitespace" class="topic-section">
                <h2>4.8 Переименования, пробелы и .gitattributes</h2>

                <p>Часто конфликты возникают из-за «шума» — изменений пробелов, окончаний строк или переименований файлов. Git предоставляет инструменты для борьбы с этим.</p>

                <h3>Детекция переименований</h3>
                <p>Git не отслеживает переименования явно. Вместо этого он эвристически сравнивает удалённый файл с добавленным: если содержимое похоже на N% — считается переименованием.</p>

                <div class="code-example">
<pre><code class="bash"># Установить порог похожести (по умолчанию 50%)
git merge -X rename-threshold=30 feature   # более агрессивная детекция

# Отключить детекцию переименований
git merge -X no-renames feature</code></pre>
                </div>

                <h3>Игнорирование пробелов при merge</h3>
                <div class="code-example">
<pre><code class="bash"># Игнорировать изменения в количестве пробелов
git merge -X ignore-space-change feature

# Игнорировать все пробелы
git merge -X ignore-all-space feature</code></pre>
                </div>

                <h3>.gitattributes: контроль окончаний строк</h3>
                <div class="code-example">
<pre><code class="bash"># Файл .gitattributes в корне проекта:
*.md   text eol=lf          # Markdown — всегда LF
*.sh   text eol=lf          # Bash скрипты — LF
*.bat  text eol=crlf        # Windows батники — CRLF
*.png  binary               # Изображения — бинарные, не мёржить</code></pre>
                </div>

                <div class="tip">
                    <p><strong>Совет:</strong> Создайте <code>.gitattributes</code> в начале проекта. Это предотвратит массу ложных конфликтов из-за разных окончаний строк у Windows и Linux разработчиков.</p>
                </div>
            </section>

            <section id="rerere" class="topic-section">
                <h2>4.9 rerere: запоминание решений конфликтов</h2>

                <p><code>rerere</code> расшифровывается как <strong>Reuse Recorded Resolution</strong>. Эта функция запоминает, как вы разрешили конфликт, и автоматически применяет то же решение, если конфликт повторится.</p>

                <h3>Когда это полезно</h3>
                <ul>
                    <li>Вы делаете <code>rebase</code> и каждый раз сталкиваетесь с одним и тем же конфликтом</li>
                    <li>Вы регулярно мёржите одну и ту же ветку (например, <code>develop</code> в <code>feature</code>)</li>
                    <li>Вы тестируете merge, отменяете его, а потом делаете заново</li>
                </ul>

                <h3>Как включить</h3>
                <div class="code-example">
<pre><code class="bash"># Включить rerere глобально
git config --global rerere.enabled true

# Проверить, что включено
git config rerere.enabled
# true</code></pre>
                </div>

                <h3>Как это работает</h3>
                <div class="code-example">
<pre><code class="bash"># 1. Делаете merge, получаете конфликт
git merge feature
# CONFLICT ...

# 2. Разрешаете конфликт вручную
# (редактируете файл, убираете маркеры)

# 3. Git записывает ваше решение
git add file.txt
git commit
# Recorded resolution for 'file.txt'.

# 4. В следующий раз при таком же конфликте:
git merge feature
# Resolved 'file.txt' using previous resolution.
# Git автоматически применил ваше прошлое решение!</code></pre>
                </div>

                <div class="note">
                    <p><strong>Где хранятся решения:</strong> в папке <code>.git/rr-cache/</code>. Это локальные данные, они не попадают в удалённый репозиторий.</p>
                </div>
            </section>

            <section id="squash-history" class="topic-section">
                <h2>4.10 Squash merge и влияние на историю</h2>

                <p><code>--squash</code> — один из самых спорных инструментов. Он собирает все коммиты ветки в один, но <strong>не создаёт merge-коммит</strong>. Это значит, что Git не знает, что слияние произошло.</p>

                <h3>Как работает squash merge</h3>
                <div class="code-example">
<pre><code class="bash"># Ветка feature/auth имеет 15 коммитов
git merge --squash feature/auth

# Все изменения в staging, но НЕ закоммичены
git commit -m "feat: авторизация пользователей"

# Результат: один чистый коммит в main
# НО: Git не знает, что feature/auth была слита</code></pre>
                </div>

                <h3>Плюсы и минусы</h3>
                <div class="visual-guide">
                    <h4>Когда squash — хорошо</h4>
                    <ul>
                        <li>Ветка содержит «мусорные» коммиты (<code>fix typo</code>, <code>wip</code>, <code>test</code>)</li>
                        <li>Вы хотите чистую линейную историю в main</li>
                        <li>Feature маленькая и логически единая</li>
                    </ul>
                </div>
                <div class="visual-guide">
                    <h4>Когда squash — плохо</h4>
                    <ul>
                        <li>Ветка большая — теряется контекст отдельных изменений</li>
                        <li><code>git log</code> не покажет, что ветка была слита → повторный merge вызовет конфликты</li>
                        <li><code>git bisect</code> не сможет найти коммит с багом внутри «сжатого» коммита</li>
                        <li>После squash ветку нужно удалять — повторно слить её невозможно</li>
                    </ul>
                </div>

                <div class="note">
                    <p><strong>Рекомендация:</strong> для коротких feature-веток (1-5 коммитов) squash удобен. Для длинных веток лучше <code>--no-ff</code> merge или предварительная «уборка» через <code>rebase -i</code>.</p>
                </div>
            </section>

            <section class="topic-section">
                <h2>Практическое задание</h2>

                <div class="exercise">
                    <h4>Задание 1: Создать и разрешить конфликт</h4>
                    <ol>
                        <li>Создайте новый репозиторий с файлом <code>index.html</code></li>
                        <li>Создайте ветку <code>feature/header</code>, измените заголовок <code>&lt;h1&gt;</code></li>
                        <li>Вернитесь в <code>main</code>, измените тот же <code>&lt;h1&gt;</code> по-другому</li>
                        <li>Выполните <code>git merge feature/header</code></li>
                        <li>Разрешите конфликт, объединив оба варианта</li>
                        <li>Завершите merge и проверьте историю: <code>git log --oneline --graph</code></li>
                    </ol>
                </div>

                <div class="exercise">
                    <h4>Задание 2: Сравнить стратегии</h4>
                    <ol>
                        <li>Создайте репозиторий с 3 коммитами в <code>main</code></li>
                        <li>Создайте ветку <code>feature</code> с 2 коммитами (без изменений в main)</li>
                        <li>Выполните <code>git merge feature</code> — какая стратегия использовалась?</li>
                        <li>Откатите: <code>git reset --hard HEAD~1</code></li>
                        <li>Теперь <code>git merge --no-ff feature</code> — в чём разница в <code>git log --graph</code>?</li>
                    </ol>
                </div>

                <div class="exercise">
                    <h4>Задание 3: Настроить rerere</h4>
                    <ol>
                        <li>Включите rerere: <code>git config rerere.enabled true</code></li>
                        <li>Создайте конфликт (как в задании 1) и разрешите его</li>
                        <li>Откатите merge: <code>git reset --hard HEAD~1</code></li>
                        <li>Повторите merge — Git должен разрешить конфликт автоматически!</li>
                    </ol>
                </div>
            </section>
        </main>
    </div>

    <!-- Мобильное меню настроек -->
    <div class="mobile-settings-menu" id="mobileSettingsMenu">
        <div class="mobile-settings-content">
            <div class="mobile-settings-header">
                <h3>Настройки</h3>
                <button class="mobile-settings-close" id="mobileSettingsClose" aria-label="Закрыть настройки">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path fill-rule="evenodd" d="M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z" clip-rule="evenodd"/>
                    </svg>
                </button>
            </div>
            
            <div class="mobile-settings-section">
                <h4>Цветовая схема</h4>
                <div class="mobile-color-scheme-buttons">
                    <button class="mobile-color-scheme-btn" data-color="purple">
                        <span class="color-dot" style="background: #6c63ff;"></span>
                        <span>Фиолетовая</span>
                    </button>
                    <button class="mobile-color-scheme-btn" data-color="orange">
                        <span class="color-dot" style="background: #f97316;"></span>
                        <span>Оранжевая</span>
                    </button>
                    <button class="mobile-color-scheme-btn" data-color="blue">
                        <span class="color-dot" style="background: #3b82f6;"></span>
                        <span>Синяя</span>
                    </button>
                </div>
            </div>
            
            <div class="mobile-settings-section">
                <h4>Тема</h4>
                <button class="mobile-theme-toggle-btn" id="mobileThemeToggle">
                    <span class="theme-label">Светлая</span>
                    <svg class="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z"/>
                    </svg>
                    <svg class="theme-icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 01.818.162z" clip-rule="evenodd"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script src="../courses.js"></script>
</body>
</html> 